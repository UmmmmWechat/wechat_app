{"version":3,"sources":["webpack:///./src/pages/tourist_main/main.js","webpack:///src/pages/tourist_main/index.vue","webpack:///./src/pages/tourist_main/index.vue?6224","webpack:///./src/assets/style/d-btn.css?6d89","webpack:///./src/assets/style/d-head.css?ed17","webpack:///./src/assets/style/d-search-list.css?d90f","webpack:///./src/pages/tourist_main/index.vue?7397","webpack:///./src/pages/tourist_main/index.vue"],"names":["app","Vue","App","$mount","config","navigationBarTitleText"],"mappings":"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AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,iBAAiB;AACF,kEAAS;AACxB,IAAI,KAAU;AACd;AACA;AACA;AACA;AACA,C;;;;;;;;ACrLA;AAAA;AAAA;AACA;AACA;AACA,EAAE,mBAAO,CAAC,GAAgiB;AAC1iB,EAAE,mBAAO,CAAC,GAAyd;AACne,EAAE,mBAAO,CAAC,GAAge;AAC1e,EAAE,mBAAO,CAAC,GAAwd;AACle;AACA,yBAAyB,mBAAO,CAAC,CAAmF;AACpH;AACgJ;AAChJ;AACkX;AAClX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,uJAAc;AAChB,EAAE,yTAAgB;AAClB;AACA;AACA;AACA;AACA;AACA,+EAA+E,sDAAsD,IAAI;AACzI,mCAAmC;;AAEnC;AACA,IAAI,KAAU,GAAG;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC;;AAEc,0EAAiB","file":"static/js/pages/tourist_main/main.js","sourcesContent":["import Vue from 'vue'\r\nimport App from './index'\r\nimport _ from 'lodash'\r\n\r\nconst app = new Vue(App)\r\napp.$mount()\r\n\r\nexport default {\r\n    config: {\r\n        navigationBarTitleText: '游伴，有伴'\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/tourist_main/main.js","<template>\r\n<div>\r\n  <div id=\"head\" class=\"d-head\">\r\n    <div id=\"user-info-div\">\r\n      <span>欢迎：</span>\r\n      <span class=\"underline-span\">\r\n        <span\r\n        class=\"underline-span\"\r\n        @click=\"handleToPersonCenter\">\r\n          <open-data type=\"userNickName\"/>\r\n        </span>\r\n      </span>\r\n    </div>\r\n    <div>\r\n      <span>旅游地点：</span>\r\n      <div style=\"display:inline-block;\">\r\n      <picker\r\n      mode=\"region\"\r\n      @change=\"handleLocationChange\"\r\n      >\r\n        <span\r\n        class=\"underline-span\" >\r\n        {{ city }}\r\n        </span>\r\n      </picker>\r\n      </div>\r\n    </div>\r\n    <div id=\"search\">\r\n      <icon type=\"search\" size=\"10\" color=\"white\"/>\r\n      <div style=\"display:inline-block;width:90%;\">\r\n        <d-input\r\n        placeholder=\"搜索景点\"\r\n        confirm-type=\"search\"\r\n        :value=\"searchValue\"\r\n        @input=\"handleSearchInput\"\r\n        @on-focus=\"handleSearchFocus\"\r\n        @on-enter=\"handleResetSearch\"/>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <scroll-view\r\n  v-if=\"!isSearch\"\r\n  class=\"scroll\"\r\n  scroll-y\r\n  scroll-with-animation\r\n  enable-back-to-top\r\n  :scroll-top=\"scrollTop\"\r\n\r\n  @scrolltolower=\"handleGetMoreSpots\">\r\n    <spot-card\r\n    v-for=\"spot in spots\"\r\n    :key=\"spot.id\"\r\n    :spot=\"spot\"\r\n    />\r\n    <div v-if=\"finishedLoading\">\r\n      <d-loading :loading=\"loading\"/>\r\n      <d-no-more :has-more=\"hasMore\" />\r\n      <d-no-more :has-more=\"!hasMore || spots.length || loading\"/>\r\n    </div>\r\n  </scroll-view>\r\n\r\n  <section\r\n    v-else\r\n    class=\"d-search-list\">\r\n    <header>\r\n      <div\r\n      style=\"text-align:center;padding:10rpx;\">\r\n        <button\r\n        class=\"d-back-btn-white\"\r\n        size=\"mini\"\r\n        plain\r\n        @click=\"handleClickBack\">\r\n          返回\r\n        </button>\r\n        <button\r\n        class=\"d-back-btn-white\"\r\n        style=\"margin-left:33rpx;\"\r\n        size=\"mini\"\r\n        plain\r\n        @click=\"handleClearSearch\">\r\n          清空\r\n        </button>\r\n      </div>\r\n    </header>\r\n\r\n    <scroll-view\r\n      class=\"scroll\"\r\n      scroll-y\r\n      scroll-with-animation\r\n      enable-back-to-top\r\n      :scroll-top=\"searchScrollTop\"\r\n      @scrolltolower=\"handleScrollToSearch\">\r\n      <spot-card\r\n      v-for=\"spot in searchSpots\"\r\n      :key=\"spot.id\"\r\n      :spot=\"spot\"/>\r\n      <div v-if=\"finishedLoading\">\r\n        <d-loading :loading=\"loading\" :color=\"'white'\"/>\r\n        <d-no-more :has-more=\"searchHasMore\" :color=\"'white'\"/>\r\n        <d-no-more :has-more=\"!searchHasMore || searchSpots.length || loading || firstSearch\" :color=\"'white'\"/>\r\n      </div>\r\n    </scroll-view>\r\n  </section>\r\n</div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport SpotCard from '../../components/spot/SpotCard';\r\nimport DInput from '../../components/common/DInput';\r\nimport DLoading from '../../components/common/DLoading';\r\nimport DNoMore from '../../components/common/DNoMore';\r\n\r\nimport touristApi from '../../api/tourist';\r\nimport spotApi from '../../api/spot';\r\n\r\nimport { TOURIST_ID } from '../../api/const/touristConst';\r\nimport { MOCK_TOURIST_ID } from '../../api/mock/tourist_mock_data';\r\nimport { TOURIST_CENTER, ROLE_SELECT } from '../pages_url';\r\n\r\nconst SHOW_TOP_SCROLLTOP = 700;\r\n\r\nexport default {\r\n  components: {\r\n    SpotCard,\r\n    DInput,\r\n    DLoading,\r\n    DNoMore\r\n  },\r\n  data () {\r\n    return {\r\n      touristId: MOCK_TOURIST_ID,\r\n\r\n      location: {\r\n        province: '江苏省',\r\n        city: '南京市',\r\n        region: '栖霞区'\r\n      },\r\n\r\n      loading: false,\r\n\r\n      hasMore: true,\r\n      spots: [],\r\n\r\n      searchHasMore: true,\r\n      isSearch: false,\r\n      searchWord: '',\r\n      searchValue: undefined, // 用于清空搜索框\r\n      searchSpots: [],\r\n      firstSearch: true,\r\n\r\n      finishedLoading: false,\r\n      pageName: 'tourist_main',\r\n\r\n      scrollTop: undefined,\r\n      searchScrollTop: undefined\r\n    }\r\n  },\r\n  computed: {\r\n    city () {\r\n      var result = '';\r\n      for (let key in this.location) {\r\n        result = result + this.location[key] + '-'\r\n      }\r\n      return result.slice(0,result.length - 1);\r\n    }\r\n  },\r\n  mounted () {\r\n    this.finishedLoading = false\r\n\r\n    this.touristId = wx.getStorageSync(TOURIST_ID);\r\n    if (!this.touristId) {\r\n      // 未找到游客ID 需要先去登录\r\n      const errMsg = \"未找到游客ID 需要先去登录\";\r\n      this.dError(errMsg);\r\n\r\n      // 输出提示信息\r\n      wx.showToast({\r\n        icon: 'none',\r\n        title: errMsg\r\n      });\r\n\r\n      const url = `/${ROLE_SELECT}`;\r\n      this.dLog('跳转', url);\r\n      wx.redirectTo({ url });\r\n\r\n      return;\r\n    }\r\n\r\n    this.hasMore = true;\r\n    this.spots.splice(0, this.spots.length);// 清空原 spots 数组\r\n\r\n    this.isSearch = false\r\n    this.firstSearch = true\r\n    this.searchHasMore = true\r\n    this.searchWord = '';\r\n    this.searchSpots.splice(0, this.searchSpots.length);// 清空原 searchSpots 数组\r\n\r\n    this.finishedLoading = true\r\n\r\n    this.getSpots();\r\n  },\r\n  methods: {\r\n    dLog(message, ...optionalParams) {\r\n        console.log(this.pageName, message, optionalParams);\r\n    },\r\n    dError(message, ...optionalParams) {\r\n        console.error(this.pageName, message, optionalParams);\r\n    },\r\n    showErrorRoast(errMsg, ...fai) {\r\n      this.dError(errMsg, fai);\r\n\r\n      // 输出提示信息\r\n      wx.showToast({\r\n          icon: 'none',\r\n          title: errMsg\r\n      });\r\n    },\r\n    searchScrollToTop() {\r\n      this.dLog(\"searchScrollToTop 方法调用\");\r\n\r\n      this.searchScrollTop = 0;\r\n      setTimeout(\r\n        () => {\r\n          this.searchScrollTop = undefined;\r\n        }, 500);\r\n\r\n      wx.pageScrollTo({\r\n        scrollTop: 0,\r\n        duration: 300\r\n      });\r\n    },\r\n    scrollToTop() {\r\n      this.dLog(\"scrollToTop 方法调用\");\r\n\r\n      this.scrollTop = 0;\r\n      setTimeout(\r\n        () => {\r\n          this.scrollTop = undefined;\r\n        }, 500);\r\n\r\n      wx.pageScrollTo({\r\n        scrollTop: 0,\r\n        duration: 300\r\n      });\r\n    },\r\n    getSpots() {\r\n      this.dLog(\"getSpots 方法调用\");\r\n\r\n      if (this.loading){\r\n        this.dLog(\"加载中 return\");\r\n        return;\r\n      }\r\n\r\n      // 加载\r\n      this.hasMore = true;\r\n      this.loading = true;\r\n\r\n      // 保留下上次最后的index\r\n      let lastIndex = this.spots.length;\r\n\r\n      // 取得景点列表\r\n      spotApi.querySpots(\r\n        this.location,\r\n        lastIndex,\r\n        (res) => {\r\n          this.dLog(\"取得景点列表成功\", res);\r\n\r\n          this.hasMore = res.hasMoreSpot;\r\n\r\n          for (let key in res.spotList) {\r\n            this.spots.push(res.spotList[key]);\r\n          }\r\n\r\n          this.loading = false;\r\n        },\r\n        (err) => {\r\n          this.showErrorRoast(\"取得景点列表失败\");\r\n\r\n          this.loading = false;\r\n        }\r\n      )\r\n    },\r\n    handleLocationChange(event) {\r\n      this.dLog(\"handleLocationChange 方法调用\", event);\r\n\r\n      var value = event.target.value;\r\n      const province = value[0];\r\n      const city = value[1];\r\n      const region = value[2];\r\n\r\n      if (this.location.province === province\r\n      && this.location.city === city\r\n      && this.location.region === region) {\r\n        // 检查是否发生了变动\r\n        this.dLog(\"所在城市未变动\");\r\n        return;\r\n      } else {\r\n        this.dLog(\"所在城市变动\", location);\r\n\r\n        const location = {\r\n          province,\r\n          city,\r\n          region\r\n        };\r\n\r\n        // 检查该城市是否支持\r\n        spotApi.checkLocationAvailable(\r\n          location,\r\n          (res) => {\r\n            this.dLog(\"检查所在城市是否支持成功\", res);\r\n\r\n            if (res.isAvailable) {\r\n              // 支持该地区\r\n              this.location = location;\r\n\r\n              if (this.isSearch) {\r\n                this.handleResetSearch(event);\r\n              } else {\r\n                this.resetSpots();\r\n\r\n                wx.pageScrollTo({\r\n                  scrollTop: 0,\r\n                  duration: 300\r\n                });\r\n              }\r\n            } else {\r\n              // 不支持该地区\r\n              this.showErrorRoast(res.errMsg);\r\n            }\r\n          },\r\n          (rej) => {this.showErrorRoast(\"检查所在城市是否支持失败\", rej);}\r\n        );\r\n      }\r\n    },\r\n    resetSpots(resolve) {\r\n      // 初始化景点信息\r\n      this.hasMore = true;\r\n      this.spots.splice(0, this.spots.length);// 清空原 spot 数组\r\n\r\n      // 上滑到顶部\r\n      this.scrollTop = 0;\r\n      setTimeout(\r\n        () => {\r\n          this.scrollTop = undefined;\r\n        }, 500);\r\n\r\n      // 重新获取景点信息\r\n\r\n      // 加载\r\n      this.loading = true;\r\n\r\n      // 取得景点列表\r\n      spotApi.querySpots(\r\n        this.location,\r\n        0,\r\n        (res) => {\r\n          this.dLog(\"取得景点列表成功\", res);\r\n\r\n          this.hasMore = res.hasMoreSpot;\r\n\r\n          for (let key in res.spotList) {\r\n            this.spots.push(res.spotList[key]);\r\n          }\r\n\r\n          this.loading = false;\r\n\r\n          if (resolve) {\r\n            resolve()\r\n          }\r\n        },\r\n        (err) => {\r\n          this.showErrorRoast(\"取得景点列表失败\", err);\r\n\r\n          this.loading = false;\r\n        }\r\n      )\r\n    },\r\n    handleGetMoreSpots(event) {\r\n      this.dLog(\"handleGetMoreSpots 方法调用\", event);\r\n      this.getSpots();\r\n    },\r\n    handleSearchFocus(event) {\r\n      this.dLog(\"handleSearchFocus 方法调用\", event);\r\n      this.isSearch = true;\r\n    },\r\n    handleSearchInput(e) {\r\n      this.dLog(\"handleInput 方法调用\", e);\r\n      this.searchWord = e;\r\n      this.dLog(`message 更新 ${this.message}`);\r\n    },\r\n    handleResetSearch(event) {\r\n      this.dLog(\"handleResetSearch 方法调用\", event);\r\n\r\n      // 非空检查\r\n      if (!this.searchWord) {\r\n        this.showErrorRoast(\"请输入搜索关键词w\");\r\n        return;\r\n      }\r\n\r\n      this.searchHasMore = true;\r\n      this.firstSearch = false\r\n      this.searchSpots.splice(0, this.searchSpots.length);// 清空搜索的 spot 数组\r\n\r\n      // 重新搜索\r\n\r\n      // 加载\r\n      this.loading = true;\r\n\r\n      // 上滑到顶部\r\n      this.searchScrollToTop();\r\n\r\n      // 按照关键词搜索景点\r\n      spotApi.querySpotsByKeywordAndCity(\r\n        this.searchWord,\r\n        this.location.city,\r\n        0,\r\n        (res) => {\r\n          this.dLog(\"搜索景点列表成功\", res);\r\n\r\n          this.searchHasMore = res.hasMoreSpot;\r\n\r\n          for (let key in res.spotList) {\r\n            this.searchSpots.push(res.spotList[key]);\r\n          }\r\n\r\n          this.loading = false;\r\n        },\r\n        (fai) => {\r\n          this.showErrorRoast(\"搜索景点列表失败\", fai);\r\n\r\n          this.loading = false;\r\n        }\r\n      );\r\n    },\r\n    handleScrollToSearch(event) {\r\n      this.dLog(\"handleScrollToSearch 方法调用\", event);\r\n\r\n      if (this.loading){\r\n        this.dLog(\"加载中 return\");\r\n        return;\r\n      }\r\n\r\n      // 加载\r\n      this.searchHasMore = true;\r\n      this.loading = true;\r\n\r\n      // 保留下上次最后的index\r\n      let lastIndex = this.searchSpots.length;\r\n\r\n      // 按照关键词搜索景点\r\n      spotApi.querySpotsByKeywordAndCity(\r\n        this.searchWord,\r\n        this.location.city,\r\n        lastIndex,\r\n        (res) => {\r\n          this.dLog(\"搜索景点列表成功\", res);\r\n\r\n          this.searchHasMore = res.hasMoreSpot;\r\n\r\n          for (let key in res.spotList) {\r\n            this.searchSpots.push(res.spotList[key]);\r\n          }\r\n\r\n          this.loading = false;\r\n        },\r\n        (fai) => {\r\n          this.showErrorRoast(\"搜索景点列表失败\");\r\n\r\n          this.loading = false;\r\n        }\r\n      );\r\n    },\r\n    handleClickBack(event) {\r\n      this.dLog(\"handleClickBack 方法调用\", event);\r\n\r\n      // 清空\r\n      this.handleClearSearch(event);\r\n\r\n      this.isSearch = false;\r\n    },\r\n    handleClearSearch(event) {\r\n      this.dLog(\"handleClearSearch 方法调用\", event);\r\n\r\n      // 清空搜索框\r\n      this.searchValue = \"\";\r\n      setTimeout(\r\n        () => {\r\n          this.searchValue = undefined;\r\n        }, 500\r\n      );\r\n\r\n      // 重置属性\r\n      this.searchWord = \"\";\r\n      this.firstSearch = true;\r\n      this.searchHasMore = true;\r\n      this.searchSpots.splice(0, this.searchSpots.length);// 清空搜索的 spot 数组\r\n\r\n      // 回滚\r\n      this.searchScrollToTop();\r\n    },\r\n    handleToPersonCenter (event) {\r\n      this.dLog(\"handleToPersonCenter 方法调用\", event);\r\n\r\n      const url = `/${TOURIST_CENTER}`;\r\n      this.dLog('跳转', url);\r\n      wx.navigateTo({ url });\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#head {\r\ncolor: white;\r\nz-index: 100;\r\n}\r\n\r\n#user-info-div {\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: flex-start;\r\n}\r\n\r\n.underline-span {\r\n  text-decoration: underline;\r\n}\r\n\r\n#search {\r\n  margin: 20rpx 0;\r\n  font-size: 0.8em;\r\n}\r\n\r\n.scroll {\r\n  height: 1200rpx;\r\n}\r\n</style>\r\n\r\n<style scoped src=\"../../assets/style/d-head.css\" />\r\n<style scoped src=\"../../assets/style/d-search-list.css\" />\r\n<style scoped src=\"../../assets/style/d-btn.css\"/>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/tourist_main/index.vue?cd05b970","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\"omit\":1,\"remove\":true}!./~/_vue-style-loader@3.1.2@vue-style-loader!./~/_css-loader@0.28.11@css-loader?{\"minimize\":false,\"sourceMap\":false}!./~/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-0c574479\",\"scoped\":true,\"hasInlineConfig\":false}!./~/_px2rpx-loader@0.1.10@px2rpx-loader?{\"baseDpr\":1,\"rpxUnit\":0.5}!./~/_postcss-loader@2.1.6@postcss-loader/lib?{\"sourceMap\":true}!./~/_mpvue-loader@1.0.13@mpvue-loader/lib/selector.js?type=styles&index=0!./src/pages/tourist_main/index.vue\n// module id = 161\n// module chunks = 7","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\"omit\":1,\"remove\":true}!./~/_vue-style-loader@3.1.2@vue-style-loader!./~/_css-loader@0.28.11@css-loader?{\"minimize\":false,\"sourceMap\":false}!./~/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-0c574479\",\"scoped\":true,\"hasInlineConfig\":false}!./~/_px2rpx-loader@0.1.10@px2rpx-loader?{\"baseDpr\":1,\"rpxUnit\":0.5}!./~/_postcss-loader@2.1.6@postcss-loader/lib?{\"sourceMap\":true}!./src/assets/style/d-btn.css\n// module id = 162\n// module chunks = 7","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\"omit\":1,\"remove\":true}!./~/_vue-style-loader@3.1.2@vue-style-loader!./~/_css-loader@0.28.11@css-loader?{\"minimize\":false,\"sourceMap\":false}!./~/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-0c574479\",\"scoped\":true,\"hasInlineConfig\":false}!./~/_px2rpx-loader@0.1.10@px2rpx-loader?{\"baseDpr\":1,\"rpxUnit\":0.5}!./~/_postcss-loader@2.1.6@postcss-loader/lib?{\"sourceMap\":true}!./src/assets/style/d-head.css\n// module id = 163\n// module chunks = 7","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\"omit\":1,\"remove\":true}!./~/_vue-style-loader@3.1.2@vue-style-loader!./~/_css-loader@0.28.11@css-loader?{\"minimize\":false,\"sourceMap\":false}!./~/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-0c574479\",\"scoped\":true,\"hasInlineConfig\":false}!./~/_px2rpx-loader@0.1.10@px2rpx-loader?{\"baseDpr\":1,\"rpxUnit\":0.5}!./~/_postcss-loader@2.1.6@postcss-loader/lib?{\"sourceMap\":true}!./src/assets/style/d-search-list.css\n// module id = 164\n// module chunks = 7","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', [_c('div', {\n    staticClass: \"d-head\",\n    attrs: {\n      \"id\": \"head\"\n    }\n  }, [_c('div', {\n    attrs: {\n      \"id\": \"user-info-div\"\n    }\n  }, [_c('span', [_vm._v(\"欢迎：\")]), _vm._v(\" \"), _c('span', {\n    staticClass: \"underline-span\"\n  }, [_c('span', {\n    staticClass: \"underline-span\",\n    attrs: {\n      \"eventid\": '0'\n    },\n    on: {\n      \"click\": _vm.handleToPersonCenter\n    }\n  }, [_c('open-data', {\n    attrs: {\n      \"type\": \"userNickName\",\n      \"mpcomid\": '0'\n    }\n  })], 1)])]), _vm._v(\" \"), _c('div', [_c('span', [_vm._v(\"旅游地点：\")]), _vm._v(\" \"), _c('div', {\n    staticStyle: {\n      \"display\": \"inline-block\"\n    }\n  }, [_c('picker', {\n    attrs: {\n      \"mode\": \"region\",\n      \"eventid\": '1'\n    },\n    on: {\n      \"change\": _vm.handleLocationChange\n    }\n  }, [_c('span', {\n    staticClass: \"underline-span\"\n  }, [_vm._v(\"\\r\\n        \" + _vm._s(_vm.city) + \"\\r\\n        \")])])], 1)]), _vm._v(\" \"), _c('div', {\n    attrs: {\n      \"id\": \"search\"\n    }\n  }, [_c('icon', {\n    attrs: {\n      \"type\": \"search\",\n      \"size\": \"10\",\n      \"color\": \"white\"\n    }\n  }), _vm._v(\" \"), _c('div', {\n    staticStyle: {\n      \"display\": \"inline-block\",\n      \"width\": \"90%\"\n    }\n  }, [_c('d-input', {\n    attrs: {\n      \"placeholder\": \"搜索景点\",\n      \"confirm-type\": \"search\",\n      \"value\": _vm.searchValue,\n      \"eventid\": '2',\n      \"mpcomid\": '1'\n    },\n    on: {\n      \"input\": _vm.handleSearchInput,\n      \"on-focus\": _vm.handleSearchFocus,\n      \"on-enter\": _vm.handleResetSearch\n    }\n  })], 1)], 1)]), _vm._v(\" \"), (!_vm.isSearch) ? _c('scroll-view', {\n    staticClass: \"scroll\",\n    attrs: {\n      \"scroll-y\": \"\",\n      \"scroll-with-animation\": \"\",\n      \"enable-back-to-top\": \"\",\n      \"scroll-top\": _vm.scrollTop,\n      \"eventid\": '6'\n    },\n    on: {\n      \"scrolltolower\": _vm.handleGetMoreSpots\n    }\n  }, [_vm._l((_vm.spots), function(spot, index) {\n    return _c('spot-card', {\n      key: spot.id,\n      attrs: {\n        \"spot\": spot,\n        \"mpcomid\": '2-' + index\n      }\n    })\n  }), _vm._v(\" \"), (_vm.finishedLoading) ? _c('div', [_c('d-loading', {\n    attrs: {\n      \"loading\": _vm.loading,\n      \"mpcomid\": '3'\n    }\n  }), _vm._v(\" \"), _c('d-no-more', {\n    attrs: {\n      \"has-more\": _vm.hasMore,\n      \"mpcomid\": '4'\n    }\n  }), _vm._v(\" \"), _c('d-no-more', {\n    attrs: {\n      \"has-more\": !_vm.hasMore || _vm.spots.length || _vm.loading,\n      \"mpcomid\": '5'\n    }\n  })], 1) : _vm._e()], 2) : _c('section', {\n    staticClass: \"d-search-list\"\n  }, [_c('header', [_c('div', {\n    staticStyle: {\n      \"text-align\": \"center\",\n      \"padding\": \"10rpx\"\n    }\n  }, [_c('button', {\n    staticClass: \"d-back-btn-white\",\n    attrs: {\n      \"size\": \"mini\",\n      \"plain\": \"\",\n      \"eventid\": '3'\n    },\n    on: {\n      \"click\": _vm.handleClickBack\n    }\n  }, [_vm._v(\"\\r\\n          返回\\r\\n        \")]), _vm._v(\" \"), _c('button', {\n    staticClass: \"d-back-btn-white\",\n    staticStyle: {\n      \"margin-left\": \"33rpx\"\n    },\n    attrs: {\n      \"size\": \"mini\",\n      \"plain\": \"\",\n      \"eventid\": '4'\n    },\n    on: {\n      \"click\": _vm.handleClearSearch\n    }\n  }, [_vm._v(\"\\r\\n          清空\\r\\n        \")])], 1)]), _vm._v(\" \"), _c('scroll-view', {\n    staticClass: \"scroll\",\n    attrs: {\n      \"scroll-y\": \"\",\n      \"scroll-with-animation\": \"\",\n      \"enable-back-to-top\": \"\",\n      \"scroll-top\": _vm.searchScrollTop,\n      \"eventid\": '5'\n    },\n    on: {\n      \"scrolltolower\": _vm.handleScrollToSearch\n    }\n  }, [_vm._l((_vm.searchSpots), function(spot, index) {\n    return _c('spot-card', {\n      key: spot.id,\n      attrs: {\n        \"spot\": spot,\n        \"mpcomid\": '6-' + index\n      }\n    })\n  }), _vm._v(\" \"), (_vm.finishedLoading) ? _c('div', [_c('d-loading', {\n    attrs: {\n      \"loading\": _vm.loading,\n      \"color\": 'white',\n      \"mpcomid\": '7'\n    }\n  }), _vm._v(\" \"), _c('d-no-more', {\n    attrs: {\n      \"has-more\": _vm.searchHasMore,\n      \"color\": 'white',\n      \"mpcomid\": '8'\n    }\n  }), _vm._v(\" \"), _c('d-no-more', {\n    attrs: {\n      \"has-more\": !_vm.searchHasMore || _vm.searchSpots.length || _vm.loading || _vm.firstSearch,\n      \"color\": 'white',\n      \"mpcomid\": '9'\n    }\n  })], 1) : _vm._e()], 2)], 1)], 1)\n}\nvar staticRenderFns = []\nrender._withStripped = true\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\nif (module.hot) {\n  module.hot.accept()\n  if (module.hot.data) {\n     require(\"vue-loader/node_modules/vue-hot-reload-api\").rerender(\"data-v-0c574479\", esExports)\n  }\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_mpvue-loader@1.0.13@mpvue-loader/lib/template-compiler?{\"id\":\"data-v-0c574479\",\"hasScoped\":true,\"transformToRequire\":{\"video\":\"src\",\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"}}!./~/_mpvue-loader@1.0.13@mpvue-loader/lib/selector.js?type=template&index=0!./src/pages/tourist_main/index.vue\n// module id = 245\n// module chunks = 7","var disposed = false\nfunction injectStyle (ssrContext) {\n  if (disposed) return\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":false,\\\"sourceMap\\\":false}!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0c574479\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!px2rpx-loader?{\\\"baseDpr\\\":1,\\\"rpxUnit\\\":0.5}!postcss-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/selector?type=styles&index=0!./index.vue\")\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":false,\\\"sourceMap\\\":false}!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0c574479\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!px2rpx-loader?{\\\"baseDpr\\\":1,\\\"rpxUnit\\\":0.5}!postcss-loader?{\\\"sourceMap\\\":true}!../../assets/style/d-head.css\")\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":false,\\\"sourceMap\\\":false}!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0c574479\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!px2rpx-loader?{\\\"baseDpr\\\":1,\\\"rpxUnit\\\":0.5}!postcss-loader?{\\\"sourceMap\\\":true}!../../assets/style/d-search-list.css\")\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":false,\\\"sourceMap\\\":false}!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0c574479\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!px2rpx-loader?{\\\"baseDpr\\\":1,\\\"rpxUnit\\\":0.5}!postcss-loader?{\\\"sourceMap\\\":true}!../../assets/style/d-btn.css\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0c574479\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":\\\"src\\\",\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"}}!../../../node_modules/_mpvue-loader@1.0.13@mpvue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-0c574479\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\nComponent.options.__file = \"src\\\\pages\\\\tourist_main\\\\index.vue\"\nif (Component.esModule && Object.keys(Component.esModule).some(function (key) {return key !== \"default\" && key.substr(0, 2) !== \"__\"})) {console.error(\"named exports are not supported in *.vue files.\")}\nif (Component.options.functional) {console.error(\"[vue-loader] index.vue: functional components are not supported with templates, they should use render functions.\")}\n\n/* hot reload */\nif (module.hot) {(function () {\n  var hotAPI = require(\"vue-loader/node_modules/vue-hot-reload-api\")\n  hotAPI.install(require(\"vue\"), false)\n  if (!hotAPI.compatible) return\n  module.hot.accept()\n  if (!module.hot.data) {\n    hotAPI.createRecord(\"data-v-0c574479\", Component.options)\n  } else {\n    hotAPI.reload(\"data-v-0c574479\", Component.options)\n  }\n  module.hot.dispose(function (data) {\n    disposed = true\n  })\n})()}\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/tourist_main/index.vue\n// module id = 84\n// module chunks = 7"],"sourceRoot":""}